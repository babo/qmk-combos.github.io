<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>Custom Engine Config - QMK Combos</title><link rel="icon" type="image/png" href="/favicon.png"><link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs.css"> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Custom Engine Config | QMK Combos</title><meta name="generator" content="Jekyll v3.8.6" /><meta property="og:title" content="Custom Engine Config" /><meta property="og:locale" content="en_US" /><meta name="description" content="QMK Combo/Chord repo for extending your mechanical keyboard!" /><meta property="og:description" content="QMK Combo/Chord repo for extending your mechanical keyboard!" /><link rel="canonical" href="http://localhost:4000/docs/custom/" /><meta property="og:url" content="http://localhost:4000/docs/custom/" /><meta property="og:site_name" content="QMK Combos" /> <script type="application/ld+json"> {"@type":"WebPage","headline":"Custom Engine Config","url":"http://localhost:4000/docs/custom/","description":"QMK Combo/Chord repo for extending your mechanical keyboard!","@context":"https://schema.org"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"><title>Link</title><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg><div class="page-wrap"><div class="side-bar"><div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> QMK Combos </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button></div><div class="navigation main-nav js-main-nav"><nav role="navigation" aria-label="Main navigation"><ul class="navigation-list"><li class="navigation-list-item"><a href="http://localhost:4000/" class="navigation-list-link">Home</a><li class="navigation-list-item"><a href="http://localhost:4000/docs/install/" class="navigation-list-link">Installation Guide</a><li class="navigation-list-item"><a href="http://localhost:4000/docs/combos/" class="navigation-list-link">Combo Docs</a><li class="navigation-list-item"><a href="http://localhost:4000/docs/chords/" class="navigation-list-link">Chording Docs</a><li class="navigation-list-item active"><a href="http://localhost:4000/docs/custom/" class="navigation-list-link active">Custom Engine Config</a><li class="navigation-list-item"><a href="http://localhost:4000/docs/manage/" class="navigation-list-link">Managing Dictionaries</a><li class="navigation-list-item"><a href="http://localhost:4000/docs/dicts/" class="navigation-list-link">Dictionary List</a></ul></nav></div><footer class="site-footer"></footer></div><div class="main-content-wrap js-main-content" tabindex="0"><div class="main-content"><div class="page-header js-page-header"><ul class="list-style-none text-small aux-nav"><li class="d-inline-block my-0"><a href="//github.com/qmk-combos/combos">GitHub</a></ul></div><div class="page"><div id="main-content" class="page-content" role="main"><h1 id="custom-engines"> <a href="#custom-engines" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Custom Engines</h1><p>If you’re setting up a board for the first time (and not using the default config), here are the dirty details for you. On the other hand, if you’re just setting things up with the default engine config, skip along to</p><p><a href="/docs/manage" class="btn">Managing Dicts</a></p><p>Sick, you’re still around! Time to get hacking away :)</p><p>So pop open <code class="highlighter-rouge">keyboards/gboards/g/config_default.h</code>. That’s what we’re going to use as a reference here. The first things you’ll notice are the two defines: <code class="highlighter-rouge">C_SIZE</code> and <code class="highlighter-rouge">COMBO_MAX</code>.</p><h3 id="c_size"> <a href="#c_size" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> C_Size</h3><p>This is the width of your chords in native AVR types. As of right now, the engine supports up to 64 states. If you’re only using a board that uses 10 keys, you can probably squeeze it into a uint16.</p><p>Helpfully, if you have a <code class="highlighter-rouge">STN()</code> call of higher than <code class="highlighter-rouge">C_SIZE</code>, the compiler will get angry :)</p><h3 id="combo_max"> <a href="#combo_max" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> COMBO_MAX</h3><p>This is the Maximum number of keys that will be passed to <code class="highlighter-rouge">KEYS()</code>. For longer key combos, this must be overridden to a value that can contain it. Note that this will be the default for <em>ALL</em> combos, so if you have one extra extra long combo it might be worth it to turn it into a <code class="highlighter-rouge">SUBS()</code> argument instead.</p><h3 id="stn"> <a href="#stn" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> STN</h3><p>This is just a wrapper for setting the bit in your chord that gets toggled. Start your symbols at 0 and count up. You <em>must</em> end before you overflow <code class="highlighter-rouge">C_SIZE</code>!</p><h3 id="command_mode"> <a href="#command_mode" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> COMMAND_MODE</h3><p>This is the chord for toggling Command Mode. When this is stroked the keyboard starts buffering inputs. When it’s stroked again the combo is sent. It’s useful for sending complex combos that would otherwise conflict with each other on smaller keyboards.</p><h3 id="engine_config"> <a href="#engine_config" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> ENGINE_CONFIG</h3><p>This section is used by the engine to hook the QMK Keycodes and set the relevant Chord bits. It falls through to regular QMK processing if these aren’t hooked. You’ll need the ending <code class="highlighter-rouge">\</code>, it's needed!</p><h2 id="overrideable-functions"> <a href="#overrideable-functions" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Overrideable Functions</h2><p>Similar to stock QMK, there are a handful of functions you can overide to change how the engine functions! Just define these in your <code class="highlighter-rouge">keymap.c</code> or in another file in your build. You should have a good understanding of <a href="https://beta.docs.qmk.fm/for-a-deeper-understanding/understanding_qmk#process-record">this page from the QMK docs!</a></p><h3 id="process_engine_post"> <a href="#process_engine_post" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> process_engine_post</h3><p><code class="highlighter-rouge">C_SIZE process_engine_post(C_SIZE cur_chord, uint16_t keycode, keyrecord_t *record)</code></p><p>This is run after a key has been matched for the engine. You can use this to set additional bits in a chord or modify other keyboard things (like LEDs!). If you just want to continue processing, return <code class="highlighter-rouge">cur_chord</code>.</p><h3 id="process_engine_pre"> <a href="#process_engine_pre" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> process_engine_pre</h3><p><code class="highlighter-rouge">C_SIZE process_engine_pre(C_SIZE cur_chord, uint16_t keycode, keyrecord_t *record)</code></p><p>This is run before <em>any</em> processing has happened. If you return false from here, normal QMK processing will happen instead of any engine things. Useful for keeping the engine from running when not on a specfic layer or for other uses.</p><h3 id="process_chord_getnext"> <a href="#process_chord_getnext" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> process_chord_getnext</h3><p><code class="highlighter-rouge">C_SIZE process_chord_getnext(C_SIZE cur_chord)</code></p><p>This is run in the event that a match could not be found. Normally the engine will try smaller and smaller bits of the chord until a match is found, but you can return the chord it should try next. Be careful though, it’s easy to end up in infinate loops! Return 0 to continue with normal engine processing.</p><p>Hopefully that answers you hackery questions! Good luck on whacking this into your board and extending it!</p><hr><footer role="contentinfo"><p class="text-small text-grey-dk-000 mb-0">A <a href="https://www.gboards.ca/"> g Heavy Industries</a> project. 2020-</p></footer></div></div></div></div>
